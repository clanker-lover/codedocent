<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>codedocent ‚Äî {{ root.name }}</title>
<script>
if (localStorage.getItem('cd-theme') === 'light')
    document.documentElement.classList.add('light-mode');
</script>
<style>
:root {
    --bg-body: #1a1a2e;
    --bg-header: #12122a;
    --bg-node: #222240;
    --bg-imports: #1e1e38;
    --bg-pseudocode: #1e2a38;
    --bg-source: #0d0d1a;
    --bg-badge: #2e2e50;
    --bg-btn: #2e2e50;
    --bg-btn-hover: #3a3a5a;
    --bg-btn-active: #4466aa;
    --bg-breadcrumb: #1e1e38;
    --bg-header-hover: #2a2a48;

    --text-primary: #e0e0e0;
    --text-body: #e0e0e0;
    --text-name: #e0e0f0;
    --text-badge: #aaaacc;
    --text-lines: #8888aa;
    --text-range: #8888aa;
    --text-warning: #FFD700;
    --text-imports-label: #8888aa;
    --text-imports-item: #bbbbcc;
    --text-summary: #bbbbcc;
    --text-placeholder: #666688;
    --text-pseudocode-label: #8888aa;
    --text-pseudocode: #ccccdd;
    --text-btn: #bbbbcc;
    --text-link: #7799ee;
    --text-toggle: #8888aa;
    --text-analyzing: #8888aa;
    --text-breadcrumb-sep: #666688;
    --text-breadcrumb-current: #e0e0e0;
    --text-source: #D4D4D4;

    --border-node: #3a3a5a;
    --border-imports: #3a3a5a;
    --border-pseudocode: #3a4a5a;
    --border-btn: #4a4a6a;
    --border-breadcrumb: #3a3a5a;
    --border-textarea: #555;

    --shadow-node: rgba(0, 0, 0, 0.3);
}

:root.light-mode {
    --bg-body: #F5F5F5;
    --bg-header: #1A1A2E;
    --bg-node: #FFFFFF;
    --bg-imports: #F9F9F9;
    --bg-pseudocode: #F0F4F8;
    --bg-source: #1E1E2E;
    --bg-badge: #EEEEEE;
    --bg-btn: #F5F5F5;
    --bg-btn-hover: #E8E8E8;
    --bg-btn-active: #1A1A2E;
    --bg-breadcrumb: #EDEDF0;
    --bg-header-hover: #FAFAFA;

    --text-primary: #333;
    --text-body: #333;
    --text-name: #1A1A2E;
    --text-badge: #666666;
    --text-lines: #888888;
    --text-range: #AAAAAA;
    --text-warning: #B8860B;
    --text-imports-label: #999999;
    --text-imports-item: #555555;
    --text-summary: #555555;
    --text-placeholder: #AAAAAA;
    --text-pseudocode-label: #999999;
    --text-pseudocode: #444444;
    --text-btn: #555;
    --text-link: #5566DD;
    --text-toggle: #888;
    --text-analyzing: #888;
    --text-breadcrumb-sep: #999;
    --text-breadcrumb-current: #333;
    --text-source: #D4D4D4;

    --border-node: #E0E0E0;
    --border-imports: #E8E8E8;
    --border-pseudocode: #D0D8E0;
    --border-btn: #D0D0D0;
    --border-breadcrumb: #D8D8DC;
    --border-textarea: #555;

    --shadow-node: rgba(0, 0, 0, 0.06);
}

*, *::before, *::after {
    box-sizing: border-box;
}

body {
    margin: 0;
    padding: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background: var(--bg-body);
    color: var(--text-body);
    line-height: 1.5;
}

.cd-header {
    background: var(--bg-header);
    color: #FFFFFF;
    padding: 16px 24px;
    margin-bottom: 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.cd-header__title {
    margin: 0;
    font-size: 20px;
    font-family: "SF Mono", "Fira Code", "Consolas", monospace;
    font-weight: 700;
}

.cd-header__path {
    margin: 4px 0 0;
    font-size: 13px;
    opacity: 0.7;
    font-family: "SF Mono", "Fira Code", "Consolas", monospace;
}

.cd-theme-toggle {
    background: none;
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 8px;
    font-size: 20px;
    cursor: pointer;
    padding: 4px 8px;
    color: #FFF;
    line-height: 1;
}

.cd-theme-toggle:hover {
    border-color: rgba(255,255,255,0.6);
}

.cd-main {
    max-width: 960px;
    margin: 0 auto;
    padding: 0 16px 48px;
}

.cd-node {
    background: var(--bg-node);
    border: 1px solid var(--border-node);
    border-radius: 8px;
    box-shadow: 0 1px 3px var(--shadow-node);
    margin-bottom: 12px;
    border-left-width: 5px;
    border-left-style: solid;
    border-left-color: var(--node-color, #CCCCCC);
}

.cd-node__header {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 8px;
    padding: 10px 14px;
}

.cd-node__icon {
    font-size: 16px;
    flex-shrink: 0;
}

.cd-node__name {
    font-family: "SF Mono", "Fira Code", "Consolas", monospace;
    font-weight: 700;
    font-size: 14px;
    color: var(--text-name);
}

.cd-node__badge {
    display: inline-block;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 2px 8px;
    border-radius: 10px;
    background: var(--bg-badge);
    color: var(--text-badge);
}

.cd-node__lines {
    font-size: 12px;
    color: var(--text-lines);
}

.cd-node__range {
    font-size: 12px;
    color: var(--text-range);
    font-family: "SF Mono", "Fira Code", "Consolas", monospace;
}

.cd-node__quality {
    font-size: 14px;
    flex-shrink: 0;
}

.cd-node__warning-text {
    font-size: 11px;
    color: var(--text-warning);
    font-style: italic;
}

.cd-node__body {
    padding: 0 14px 10px;
}

.cd-imports {
    background: var(--bg-imports);
    border: 1px solid var(--border-imports);
    border-radius: 6px;
    padding: 8px 12px;
    margin-bottom: 8px;
}

.cd-imports__label {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-imports-label);
    cursor: pointer;
    list-style: none;
}

.cd-imports__label::-webkit-details-marker {
    display: none;
}

.cd-imports__label::before {
    content: "‚ñ∂ ";
    font-size: 9px;
}

.cd-imports[open] > .cd-imports__label::before {
    content: "‚ñº ";
}

.cd-imports__item {
    font-family: "SF Mono", "Fira Code", "Consolas", monospace;
    font-size: 13px;
    color: var(--text-imports-item);
    padding: 1px 0;
}

.cd-summary {
    color: var(--text-summary);
    font-size: 13px;
    margin-bottom: 8px;
}

.cd-summary--placeholder {
    font-style: italic;
    color: var(--text-placeholder);
}

.cd-pseudocode {
    background: var(--bg-pseudocode);
    border: 1px solid var(--border-pseudocode);
    border-radius: 6px;
    padding: 8px 12px;
    margin-bottom: 8px;
}

.cd-pseudocode__label {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-pseudocode-label);
    margin-bottom: 4px;
}

.cd-pseudocode__code {
    font-family: "SF Mono", "Fira Code", "Consolas", monospace;
    font-size: 13px;
    color: var(--text-pseudocode);
    margin: 0;
    white-space: pre-wrap;
}

.cd-warnings {
    margin-bottom: 8px;
}

.cd-warnings__item {
    font-size: 13px;
    color: var(--text-warning);
    padding: 2px 0;
}

.cd-node__children {
    padding-left: 16px;
}

.cd-code-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 8px;
}

.cd-code-btn {
    font-size: 12px;
    font-weight: 600;
    padding: 4px 12px;
    border-radius: 14px;
    border: 1px solid var(--border-btn);
    background: var(--bg-btn);
    color: var(--text-btn);
    cursor: pointer;
    transition: background 0.15s, color 0.15s;
}

.cd-code-btn:hover {
    background: var(--bg-btn-hover);
}

.cd-code-btn--active {
    background: var(--bg-btn-active);
    color: #FFF;
    border-color: var(--bg-btn-active);
}

.cd-code-btn--copied {
    background: #2E7D32;
    color: #FFF;
    border-color: #2E7D32;
}

.cd-source-display {
    display: none;
    background: var(--bg-source);
    color: var(--text-source);
    border-radius: 6px;
    padding: 12px;
    margin-bottom: 8px;
    font-family: "SF Mono", "Fira Code", "Consolas", monospace;
    font-size: 13px;
    overflow-x: auto;
    white-space: pre;
    line-height: 1.5;
    margin-top: 0;
}

.cd-source-display--open {
    display: block;
}

@media (max-width: 600px) {
    .cd-header {
        padding: 12px 12px;
    }
    .cd-main {
        padding: 0 8px 32px;
    }
    .cd-node__header {
        padding: 8px 10px;
    }
    .cd-node__body {
        padding: 0 10px 8px;
    }
    .cd-node__children {
        padding-left: 8px;
    }
}
</style>
</head>
<body>

{% macro render_node(node) %}
<div class="cd-node cd-node--{{ node.node_type }}" style="--node-color: {{ get_color(node) }};">
    <div class="cd-node__header">
        <span class="cd-node__icon">{{ NODE_ICONS.get(node.node_type, '') }}</span>
        <span class="cd-node__name">{{ node.name }}</span>
        <span class="cd-node__badge">{{ node.node_type }}</span>
        <span class="cd-node__lines">{{ node.line_count }} lines</span>
        {% if node.node_type in ('function', 'method') and node.start_line and node.end_line %}
        <span class="cd-node__range">L{{ node.start_line }}‚Äì{{ node.end_line }}</span>
        {% endif %}
        {% if node.quality == 'warning' %}
        <span class="cd-node__quality">üî¥</span>
        {% elif node.quality == 'complex' %}
        <span class="cd-node__quality">üü°</span>
        {% else %}
        <span class="cd-node__quality">üü¢</span>
        {% endif %}
        {% if node.warnings %}
        <span class="cd-node__warning-text">{{ node.warnings | join('; ') }}</span>
        {% endif %}
    </div>
    <div class="cd-node__body">
        {% if node.imports %}
        <details class="cd-imports">
            <summary class="cd-imports__label">IMPORTS ({{ node.imports | length }})</summary>
            {% for imp in node.imports %}
            <div class="cd-imports__item">‚Üí {{ imp }}</div>
            {% endfor %}
        </details>
        {% endif %}
        {% if node.summary %}
        <div class="cd-summary">{{ node.summary }}</div>
        {% elif node.node_type != 'directory' %}
        <div class="cd-summary cd-summary--placeholder">AI summary pending...</div>
        {% endif %}
        {% if node.pseudocode and node.node_type in ('function', 'method') %}
        <div class="cd-pseudocode">
            <div class="cd-pseudocode__label">PSEUDOCODE</div>
            <pre class="cd-pseudocode__code">{{ node.pseudocode }}</pre>
        </div>
        {% endif %}
        {% if node.warnings %}
        <div class="cd-warnings">
            {% for w in node.warnings %}
            <div class="cd-warnings__item">‚ö†Ô∏è {{ w }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% if node.node_type != 'directory' and node.source %}
        <div class="cd-code-actions">
            <button class="cd-code-btn" onclick="cdToggleSource(this)">Show Code</button>
            <button class="cd-code-btn" onclick="cdExportCode(this)">Export Code</button>
            <button class="cd-code-btn" onclick="cdCopyForAI(this)">Copy for AI</button>
        </div>
        <pre class="cd-source-display"
             data-node-type="{{ node.node_type }}"
             data-node-name="{{ node.name }}"
             data-filepath="{{ node.filepath }}"
             data-language="{{ node.language or '' }}">{{ node.source }}</pre>
        {% endif %}
        {% if node.children %}
        <div class="cd-node__children">
            {% for child in node.children %}
            {{ render_node(child) }}
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>
{% endmacro %}

<header class="cd-header">
    <div class="cd-header__text">
        <h1 class="cd-header__title">codedocent</h1>
        <p class="cd-header__path">{{ root.filepath or root.name }}</p>
    </div>
    <button class="cd-theme-toggle" id="cd-theme-toggle"
            onclick="cdToggleTheme()" aria-label="Toggle theme"></button>
</header>

<main class="cd-main">
    {{ render_node(root) }}
</main>

<script>
function cdToggleTheme() {
    var isLight = document.documentElement.classList.toggle('light-mode');
    localStorage.setItem('cd-theme', isLight ? 'light' : 'dark');
    document.getElementById('cd-theme-toggle').textContent = isLight ? '\u{1F319}' : '\u2600\uFE0F';
}
(function() {
    var btn = document.getElementById('cd-theme-toggle');
    if (btn) btn.textContent = document.documentElement.classList.contains('light-mode') ? '\u{1F319}' : '\u2600\uFE0F';
})();

function cdToggleSource(btn) {
    var pre = btn.closest('.cd-node__body').querySelector('.cd-source-display');
    var isOpen = pre.classList.contains('cd-source-display--open');
    if (isOpen) {
        pre.classList.remove('cd-source-display--open');
        btn.classList.remove('cd-code-btn--active');
        btn.textContent = 'Show Code';
    } else {
        pre.classList.add('cd-source-display--open');
        btn.classList.add('cd-code-btn--active');
        btn.textContent = 'Hide Code';
    }
}

function cdExportCode(btn) {
    var pre = btn.closest('.cd-node__body').querySelector('.cd-source-display');
    cdCopyToClipboard(pre.textContent, btn);
}

function cdCopyForAI(btn) {
    var pre = btn.closest('.cd-node__body').querySelector('.cd-source-display');
    var nodeType = pre.dataset.nodeType;
    var nodeName = pre.dataset.nodeName;
    var filepath = pre.dataset.filepath;
    var language = pre.dataset.language;
    var text = 'This is the ' + nodeType + ' `' + nodeName + '` from `' + filepath + '`:\n\n```' + language + '\n' + pre.textContent + '\n```';
    cdCopyToClipboard(text, btn);
}

function cdCopyToClipboard(text, btn) {
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(function() {
            cdShowCopied(btn);
        }, function() {
            cdFallbackCopy(text, btn);
        });
    } else {
        cdFallbackCopy(text, btn);
    }
}

function cdFallbackCopy(text, btn) {
    var ta = document.createElement('textarea');
    ta.value = text;
    ta.style.position = 'fixed';
    ta.style.left = '-9999px';
    document.body.appendChild(ta);
    ta.select();
    try { document.execCommand('copy'); cdShowCopied(btn); }
    catch(e) {}
    document.body.removeChild(ta);
}

function cdShowCopied(btn) {
    var orig = btn.textContent;
    btn.textContent = 'Copied!';
    btn.classList.add('cd-code-btn--copied');
    setTimeout(function() {
        btn.textContent = orig;
        btn.classList.remove('cd-code-btn--copied');
    }, 1500);
}
</script>

</body>
</html>
