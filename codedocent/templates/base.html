<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>codedocent ‚Äî {{ root.name }}</title>
<style>
*, *::before, *::after {
    box-sizing: border-box;
}

body {
    margin: 0;
    padding: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background: #F5F5F5;
    color: #333;
    line-height: 1.5;
}

.cd-header {
    background: #1A1A2E;
    color: #FFFFFF;
    padding: 16px 24px;
    margin-bottom: 24px;
}

.cd-header__title {
    margin: 0;
    font-size: 20px;
    font-family: "SF Mono", "Fira Code", "Consolas", monospace;
    font-weight: 700;
}

.cd-header__path {
    margin: 4px 0 0;
    font-size: 13px;
    opacity: 0.7;
    font-family: "SF Mono", "Fira Code", "Consolas", monospace;
}

.cd-main {
    max-width: 960px;
    margin: 0 auto;
    padding: 0 16px 48px;
}

.cd-node {
    background: #FFFFFF;
    border: 1px solid #E0E0E0;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
    margin-bottom: 12px;
    border-left-width: 5px;
    border-left-style: solid;
}

.cd-node__header {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 8px;
    padding: 10px 14px;
}

.cd-node__icon {
    font-size: 16px;
    flex-shrink: 0;
}

.cd-node__name {
    font-family: "SF Mono", "Fira Code", "Consolas", monospace;
    font-weight: 700;
    font-size: 14px;
    color: #1A1A2E;
}

.cd-node__badge {
    display: inline-block;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 2px 8px;
    border-radius: 10px;
    background: #EEEEEE;
    color: #666666;
}

.cd-node__lines {
    font-size: 12px;
    color: #888888;
}

.cd-node__range {
    font-size: 12px;
    color: #AAAAAA;
    font-family: "SF Mono", "Fira Code", "Consolas", monospace;
}

.cd-node__quality {
    font-size: 14px;
    flex-shrink: 0;
}

.cd-node__warning-text {
    font-size: 11px;
    color: #B8860B;
    font-style: italic;
}

.cd-node__body {
    padding: 0 14px 10px;
}

.cd-imports {
    background: #F9F9F9;
    border: 1px solid #E8E8E8;
    border-radius: 6px;
    padding: 8px 12px;
    margin-bottom: 8px;
}

.cd-imports__label {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #999999;
    margin-bottom: 4px;
}

.cd-imports__item {
    font-family: "SF Mono", "Fira Code", "Consolas", monospace;
    font-size: 13px;
    color: #555555;
    padding: 1px 0;
}

.cd-summary {
    color: #555555;
    font-size: 13px;
    margin-bottom: 8px;
}

.cd-summary--placeholder {
    font-style: italic;
    color: #AAAAAA;
}

.cd-pseudocode {
    background: #F0F4F8;
    border: 1px solid #D0D8E0;
    border-radius: 6px;
    padding: 8px 12px;
    margin-bottom: 8px;
}

.cd-pseudocode__label {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #999999;
    margin-bottom: 4px;
}

.cd-pseudocode__code {
    font-family: "SF Mono", "Fira Code", "Consolas", monospace;
    font-size: 13px;
    color: #444444;
    margin: 0;
    white-space: pre-wrap;
}

.cd-warnings {
    margin-bottom: 8px;
}

.cd-warnings__item {
    font-size: 13px;
    color: #B8860B;
    padding: 2px 0;
}

.cd-node__children {
    padding-left: 16px;
}

.cd-code-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 8px;
}

.cd-code-btn {
    font-size: 12px;
    font-weight: 600;
    padding: 4px 12px;
    border-radius: 14px;
    border: 1px solid #D0D0D0;
    background: #F5F5F5;
    color: #555;
    cursor: pointer;
    transition: background 0.15s, color 0.15s;
}

.cd-code-btn:hover {
    background: #E8E8E8;
}

.cd-code-btn--active {
    background: #1A1A2E;
    color: #FFF;
    border-color: #1A1A2E;
}

.cd-code-btn--copied {
    background: #2E7D32;
    color: #FFF;
    border-color: #2E7D32;
}

.cd-source-display {
    display: none;
    background: #1E1E2E;
    color: #D4D4D4;
    border-radius: 6px;
    padding: 12px;
    margin-bottom: 8px;
    font-family: "SF Mono", "Fira Code", "Consolas", monospace;
    font-size: 13px;
    overflow-x: auto;
    white-space: pre;
    line-height: 1.5;
    margin-top: 0;
}

.cd-source-display--open {
    display: block;
}

@media (max-width: 600px) {
    .cd-header {
        padding: 12px 12px;
    }
    .cd-main {
        padding: 0 8px 32px;
    }
    .cd-node__header {
        padding: 8px 10px;
    }
    .cd-node__body {
        padding: 0 10px 8px;
    }
    .cd-node__children {
        padding-left: 8px;
    }
}
</style>
</head>
<body>

{% macro render_node(node) %}
<div class="cd-node cd-node--{{ node.node_type }}" style="border-left-color: {{ get_color(node) }};">
    <div class="cd-node__header">
        <span class="cd-node__icon">{{ NODE_ICONS.get(node.node_type, '') }}</span>
        <span class="cd-node__name">{{ node.name }}</span>
        <span class="cd-node__badge">{{ node.node_type }}</span>
        <span class="cd-node__lines">{{ node.line_count }} lines</span>
        {% if node.node_type in ('function', 'method') and node.start_line and node.end_line %}
        <span class="cd-node__range">L{{ node.start_line }}‚Äì{{ node.end_line }}</span>
        {% endif %}
        {% if node.quality == 'warning' %}
        <span class="cd-node__quality">üî¥</span>
        {% elif node.quality == 'complex' %}
        <span class="cd-node__quality">üü°</span>
        {% else %}
        <span class="cd-node__quality">üü¢</span>
        {% endif %}
        {% if node.warnings %}
        <span class="cd-node__warning-text">{{ node.warnings | join('; ') }}</span>
        {% endif %}
    </div>
    <div class="cd-node__body">
        {% if node.imports %}
        <div class="cd-imports">
            <div class="cd-imports__label">IMPORTS</div>
            {% for imp in node.imports %}
            <div class="cd-imports__item">‚Üí {{ imp }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% if node.summary %}
        <div class="cd-summary">{{ node.summary }}</div>
        {% elif node.node_type != 'directory' %}
        <div class="cd-summary cd-summary--placeholder">AI summary pending...</div>
        {% endif %}
        {% if node.pseudocode and node.node_type in ('function', 'method') %}
        <div class="cd-pseudocode">
            <div class="cd-pseudocode__label">PSEUDOCODE</div>
            <pre class="cd-pseudocode__code">{{ node.pseudocode }}</pre>
        </div>
        {% endif %}
        {% if node.warnings %}
        <div class="cd-warnings">
            {% for w in node.warnings %}
            <div class="cd-warnings__item">‚ö†Ô∏è {{ w }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% if node.node_type != 'directory' and node.source %}
        <div class="cd-code-actions">
            <button class="cd-code-btn" onclick="cdToggleSource(this)">Show Code</button>
            <button class="cd-code-btn" onclick="cdExportCode(this)">Export Code</button>
            <button class="cd-code-btn" onclick="cdCopyForAI(this)">Copy for AI</button>
        </div>
        <pre class="cd-source-display"
             data-node-type="{{ node.node_type }}"
             data-node-name="{{ node.name }}"
             data-filepath="{{ node.filepath }}"
             data-language="{{ node.language or '' }}">{{ node.source }}</pre>
        {% endif %}
        {% if node.children %}
        <div class="cd-node__children">
            {% for child in node.children %}
            {{ render_node(child) }}
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>
{% endmacro %}

<header class="cd-header">
    <h1 class="cd-header__title">codedocent</h1>
    <p class="cd-header__path">{{ root.filepath or root.name }}</p>
</header>

<main class="cd-main">
    {{ render_node(root) }}
</main>

<script>
function cdToggleSource(btn) {
    var pre = btn.closest('.cd-node__body').querySelector('.cd-source-display');
    var isOpen = pre.classList.contains('cd-source-display--open');
    if (isOpen) {
        pre.classList.remove('cd-source-display--open');
        btn.classList.remove('cd-code-btn--active');
        btn.textContent = 'Show Code';
    } else {
        pre.classList.add('cd-source-display--open');
        btn.classList.add('cd-code-btn--active');
        btn.textContent = 'Hide Code';
    }
}

function cdExportCode(btn) {
    var pre = btn.closest('.cd-node__body').querySelector('.cd-source-display');
    cdCopyToClipboard(pre.textContent, btn);
}

function cdCopyForAI(btn) {
    var pre = btn.closest('.cd-node__body').querySelector('.cd-source-display');
    var nodeType = pre.dataset.nodeType;
    var nodeName = pre.dataset.nodeName;
    var filepath = pre.dataset.filepath;
    var language = pre.dataset.language;
    var text = 'This is the ' + nodeType + ' `' + nodeName + '` from `' + filepath + '`:\n\n```' + language + '\n' + pre.textContent + '\n```';
    cdCopyToClipboard(text, btn);
}

function cdCopyToClipboard(text, btn) {
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(function() {
            cdShowCopied(btn);
        }, function() {
            cdFallbackCopy(text, btn);
        });
    } else {
        cdFallbackCopy(text, btn);
    }
}

function cdFallbackCopy(text, btn) {
    var ta = document.createElement('textarea');
    ta.value = text;
    ta.style.position = 'fixed';
    ta.style.left = '-9999px';
    document.body.appendChild(ta);
    ta.select();
    try { document.execCommand('copy'); cdShowCopied(btn); }
    catch(e) {}
    document.body.removeChild(ta);
}

function cdShowCopied(btn) {
    var orig = btn.textContent;
    btn.textContent = 'Copied!';
    btn.classList.add('cd-code-btn--copied');
    setTimeout(function() {
        btn.textContent = orig;
        btn.classList.remove('cd-code-btn--copied');
    }, 1500);
}
</script>

</body>
</html>
